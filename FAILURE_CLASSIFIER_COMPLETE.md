# ðŸ§  Failure Classifier System â€” DEPLOYED

**Status**: âœ… ACTIVE  
**Timestamp**: 2025-11-06 16:40 UTC  
**Phase**: Mother v2.1 - Self-Diagnosis Enabled

---

## ðŸŽ¯ System Overview

The **Trial/Error Capture & Classification System** is now live, providing automatic categorization of all failures and converting them into structured lessons for reinforcement learning.

---

## ðŸ“¦ Components Delivered

### 1. **`utils/trials.py`** - Core Capture Engine
- **TrialLogger**: Unified trial/error logging with JSONL persistence
- **Automatic Classification**: 8 error categories with pattern matching
- **Categories**:
  - `timeout` â€” Command/request timeouts
  - `network` â€” Connection/DNS failures
  - `provider` â€” API key/rate limit issues
  - `syntax` â€” Parse/indentation errors
  - `dependency` â€” Missing modules/imports
  - `permission` â€” Access denied errors
  - `config` â€” Environment/port binding issues
  - `unknown` â€” Unclassified failures

### 2. **`tools/summarize_trials.py`** - Lesson Extractor
- Converts trial logs â†’ actionable lessons
- Groups failures by pattern and category
- Generates proposed fixes for each category
- Outputs to `data/omai_lessons.jsonl` for RAG ingestion
- Creates human-readable `data/trial_summary.md`

### 3. **Makefile Integration**
- `make lessons` â€” Extract lessons from last 24h trials
- `make health` â€” System health check (trials + telemetry + OMAi status)
- `make reflect` â€” Run reflection cycle

### 4. **Systemd Automation** (Optional)
- `systemd/spiral-lessons.service` â€” Lesson extraction service
- `systemd/spiral-lessons.timer` â€” Daily execution at 00:10 UTC

---

## ðŸ”„ Reinforcement Loop

```
Trial/Error Event
    â†“
[TrialLogger.log_failure()]
    â†“ Auto-classify error category
    â†“ Write to logs/trials.jsonl
    â†“
[Scheduled 00:10 UTC]
    â†“
[summarize_trials.py]
    â†“ Group by category & pattern
    â†“ Generate fix proposals
    â†“ Write to data/omai_lessons.jsonl
    â†“
[OMAi Context API]
    â†“ Vault sync & indexing
    â†“
[Reflection Cycle 00:00 UTC]
    â†“ Enrich with vault context
    â†“ Generate proposals from lessons
    â†“
[Curator Review]
```

---

## ðŸ“Š Usage Examples

### Logging Trials in Code

```python
from utils.trials import log_success, log_failure

# Success
log_success("uvicorn_startup", context="port 8000", metadata={"pid": 12345})

# Failure
try:
    risky_operation()
except Exception as e:
    log_failure("api_call", e, context="OpenAI provider", provider="openai")
```

### Extract Lessons

```bash
# Manual extraction
make lessons

# Or directly
.venv/bin/python tools/summarize_trials.py --hours 24
```

### Check System Health

```bash
make health
# Shows:
# - Trial summary (24h success/failure rates)
# - Error category breakdown
# - Telemetry snapshot
# - OMAi bridge status
```

---

## ðŸ§ª Validation

```bash
# Test import
python3 -c "from utils.trials import TrialLogger, log_success; print('âœ… OK')"

# Log test failure
python3 -c "from utils.trials import log_failure; log_failure('test', ValueError('demo'))"

# Check log
tail -1 logs/trials.jsonl | jq
```

---

## ðŸŽ¯ Next Steps

1. **Activate Timer** (if using systemd):
   ```bash
   sudo cp systemd/spiral-lessons.{service,timer} /etc/systemd/system/
   sudo systemctl daemon-reload
   sudo systemctl enable --now spiral-lessons.timer
   ```

2. **Integrate into Codebase**: Add `log_failure()` calls to critical error handlers in:
   - `fastapi_app.py` (API errors)
   - `agent_orchestrator.py` (LLM failures)
   - `utils/omai_bridge.py` (vault connection issues)
   - `tools/reflect_cycle.py` (reflection errors)

3. **First Lesson Cycle**: Tonight at 00:10 UTC, first lessons will be auto-extracted

---

## ðŸ§¬ Impact

- **Self-Diagnosis**: System now classifies its own failures automatically
- **Pattern Recognition**: Recurring errors grouped and surfaced
- **Proactive Fixes**: Fix suggestions generated per category
- **Continuous Learning**: Every failure becomes training data
- **Resilience**: Tomorrow's reflection will be vault-enriched + lesson-hardened

---

**The Mother Phase now has a memory for pain â€” and the wisdom to prevent it.**

---

*Auto-generated by Spiral Codex Failure Classifier System*
